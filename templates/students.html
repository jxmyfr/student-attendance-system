{% extends 'base.html' %}

{% block title %}‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (Student Management){% endblock %}

{% block content %}
<style>
    .student-container { background: white; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.03); padding: 25px; }
    .header-actions { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 2px solid #edf2f7; }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏° */
    .btn-add { background-color: #3182ce; color: white; border: none; padding: 10px 20px; border-radius: 6px; font-family: 'Sarabun', sans-serif; font-size: 16px; text-decoration: none; transition: background 0.3s; }
    .btn-add:hover { background-color: #2b6cb0; }
    .btn-delete { background-color: #e53e3e; color: white; padding: 6px 12px; border-radius: 4px; text-decoration: none; font-size: 14px; transition: 0.3s; }
    .btn-delete:hover { background-color: #c53030; }
    
    /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏ï‡∏≤‡∏£‡∏≤‡∏á */
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #edf2f7; }
    th { background-color: #f7fafc; color: #4a5568; font-weight: 700; }
    tr:hover { background-color: #ebf8ff; }
</style>

<div class="student-container">
    <div class="header-actions">
        <h3 style="color: #2d3748; margin: 0;"><i class="fas fa-user-graduate"></i> ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö</h3>
        
        <div style="display: flex; gap: 10px;">
            <input type="file" id="excelFile" accept=".xlsx" style="display: none;" onchange="uploadExcel()">
            
            <button class="btn-add" style="background-color: #38a169;" onclick="document.getElementById('excelFile').click()">
                <i class="fas fa-file-excel"></i> ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏à‡∏≤‡∏Å Excel
            </button>

            <a href="/register_student" class="btn-add">
                <i class="fas fa-camera"></i> ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡πÉ‡∏ö‡∏´‡∏ô‡πâ‡∏≤
            </a>
        </div>
    </div>

    <script>
    function uploadExcel() {
        const fileInput = document.getElementById('excelFile');
        const file = fileInput.files[0];
        if (!file) return;

        const formData = new FormData();
        formData.append('file', file);

        // ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡πÄ‡∏°‡∏≤‡∏™‡πå‡πÄ‡∏õ‡πá‡∏ô‡∏£‡∏π‡∏õ‡∏ô‡∏≤‡∏¨‡∏¥‡∏Å‡∏≤‡∏ó‡∏£‡∏≤‡∏¢
        document.body.style.cursor = 'wait';

        fetch('/import_students', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            document.body.style.cursor = 'default';
            if (data.status === 'success') {
                alert("üéâ " + data.message);
                window.location.reload(); // ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏ä‡∏ß‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            } else {
                alert("‚ùå ‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: " + data.message);
            }
            fileInput.value = ''; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡πÑ‡∏ü‡∏•‡πå
        })
        .catch(error => {
            document.body.style.cursor = 'default';
            console.error('Error:', error);
            alert("‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå");
            fileInput.value = '';
        });
    }
    </script>

    <table>
        <thead>
            <tr>
                <th>‡∏´‡πâ‡∏≠‡∏á</th>        <th>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà</th>       <th>‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                <th>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• (TH)</th>
                <th style="text-align: center;">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
        </thead>
        <tbody>
            {% for std in students %}
            <tr>
                <td>{{ std.classroom }}</td>
                <td>{{ std.roll_number }}</td> <td><strong>{{ std.id }}</strong></td>
                <td>{{ std.name_th }}</td>
                <td style="text-align: center;">
                    <a href="{{ url_for('delete_student_route', student_id=std.id) }}" class="btn-delete" 
                       onclick="return confirm('‚ö†Ô∏è ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏à‡∏∞‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á {{ std.name_th }} ?');">
                        <i class="fas fa-trash-alt"></i> ‡∏•‡∏ö
                    </a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" style="text-align: center; color: #a0aec0; padding: 30px;">
                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}