{% extends 'base.html' %}
{% block content %}
<div class="container" style="background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
    <h2 style="margin-bottom: 25px;"><i class="fas fa-clipboard-check"></i> จัดการข้อมูลการเข้าเรียนรายวัน</h2>
    
    <form method="GET" style="margin-bottom: 30px; display: flex; gap: 10px;">
        <select name="class_name" class="form-select" style="max-width: 200px; padding: 10px; border-radius: 6px;">
            <option value="">-- เลือกห้องเรียน --</option>
            {% for c in class_list %}
            <option value="{{ c }}" {% if c == selected_class %}selected{% endif %}>{{ c }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-add" style="background: #3182ce; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer;">ดึงรายชื่อ</button>
    </form>

    {% if selected_class %}
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
        <div>
            <h4 style="color: #e53e3e;"><i class="fas fa-user-times"></i> ยังไม่ได้เช็กชื่อ (ลงสถานะ ขาด/ลา)</h4>
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                {% for s in missing_students %}
                <tr style="border-bottom: 1px solid #edf2f7;">
                    <td style="padding: 10px;">{{ s.roll_number }}. {{ s.name_th }}</td>
                    <td style="text-align: right; padding: 10px;">
                        <button onclick="saveStatus('{{ s.id }}', 'Sick Leave')" style="background: #ecc94b; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; font-size: 12px;">ลาป่วย</button>
                        <button onclick="saveStatus('{{ s.id }}', 'Personal Leave')" style="background: #ed8936; border: none; padding: 5px 10px; border-radius: 4px; color: white; cursor: pointer; font-size: 12px;">ลากิจ</button>
                        <button onclick="saveStatus('{{ s.id }}', 'Absent')" style="background: #e53e3e; border: none; padding: 5px 10px; border-radius: 4px; color: white; cursor: pointer; font-size: 12px;">ขาด</button>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>

        <div>
            <h4 style="color: #48bb78;"><i class="fas fa-user-check"></i> เช็กชื่อแล้ว</h4>
            <table style="width: 100%; border-collapse: collapse; margin-top: 15px;">
                {% for r in records %}
                <tr style="border-bottom: 1px solid #edf2f7;">
                    <td style="padding: 10px;">{{ r.student.name_th }}</td>
                    <td style="padding: 10px; color: #718096;">{{ r.time.strftime('%H:%M') }}</td>
                    <td style="text-align: right; padding: 10px;">
                        <span style="background: #f0fff4; color: #2f855a; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold;">{{ r.status }}</span>
                    </td>
                </tr>
                {% endfor %}
            </table>
        </div>
    </div>
    {% endif %}
</div>

<script>
function saveStatus(id, status) {
    fetch('/add_missing_status', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({student_id: id, status: status})
    }).then(() => location.reload());
}
</script>
{% endblock %}